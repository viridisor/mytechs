<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHURLS | Advanced Edition</title>
    <style>
        :root { --bg: #fcfcfc; --header: #1a1a1a; --link: #0055aa; --border: #333; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; font-size: 13px; color: #333; }
        
        /* 顶部导航 */
        header { background: var(--header); color: white; padding: 0 25px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; height: 45px; }
        header h1 { font-size: 16px; margin: 0; cursor: pointer; font-weight: 900; letter-spacing: 1px; }
        #search-input { background: #333; border: 1px solid #444; color: #fff; padding: 5px 10px; font-size: 12px; border-radius: 3px; width: 200px; outline: none; }

        /* 3列布局容器 */
        .main-container { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 35px; 
            padding: 30px; 
            max-width: 1400px; 
            margin: 0 auto; 
            align-items: start; 
        }

        /* 站点卡片 */
        .site-column { 
            border-top: 4px solid var(--border); 
            padding-top: 10px; 
            background: #fff;
            display: flex;
            flex-direction: column;
            height: 500px; /* 固定高度 */
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .site-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; padding: 0 5px; }
        .site-name { font-weight: 900; font-size: 14px; text-transform: uppercase; color: #000; text-decoration: none; }
        .site-domain { font-size: 10px; color: #999; }

        /* 滚动列表 */
        .article-list { 
            list-style: none; 
            padding: 0 5px; 
            margin: 0; 
            overflow-y: auto; /* 开启滚动 */
            flex-grow: 1;
        }

        /* 美化滚动条 */
        .article-list::-webkit-scrollbar { width: 4px; }
        .article-list::-webkit-scrollbar-thumb { background: #eee; border-radius: 10px; }
        .article-list::-webkit-scrollbar-thumb:hover { background: #ccc; }

        .article-item { margin-bottom: 8px; display: flex; align-items: flex-start; }
        .time-badge { font-size: 10px; color: #aaa; min-width: 38px; font-family: monospace; padding-top: 2px; }
        .article-link { text-decoration: none; color: var(--link); line-height: 1.4; }
        .article-link:hover { text-decoration: underline; }

        /* 手动加载按钮样式 */
        .load-more-area {
            padding: 10px;
            text-align: center;
            border-top: 1px solid #f0f0f0;
            background: #fff;
        }
        .load-more-btn {
            background: none;
            border: 1px solid #ddd;
            color: #888;
            font-size: 11px;
            padding: 4px 12px;
            border-radius: 15px;
            cursor: pointer;
            text-transform: uppercase;
        }
        .load-more-btn:hover { background: #f9f9f9; color: #333; border-color: #bbb; }

        .hidden { display: none !important; }

        /* 适配响应式 */
        @media (max-width: 1000px) { .main-container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 650px) { .main-container { grid-template-columns: 1fr; } .site-column { height: 400px; } }
    </style>
</head>
<body>

<header>
    <h1 onclick="location.reload()">TECHURLS</h1>
    <input type="text" id="search-input" placeholder="SEARCH NEWS..." autocomplete="off">
</header>

<div class="main-container" id="content-grid"></div>

<script>
    const INITIAL_COUNT = 8; // 默认显示的阈值：每个网站显示 8 条

    async function init() {
        const grid = document.getElementById('content-grid');
        try {
            const response = await fetch('./data/data.json?v=' + Date.now());
            const data = await response.json();

            grid.innerHTML = data.map((site, index) => {
                const hasMore = site.articles.length > INITIAL_COUNT;
                
                return `
                <div class="site-column" id="site-${index}">
                    <div class="site-header">
                        <a href="${site.url || '#'}" class="site-name">${site.source}</a>
                        <span class="site-domain">${site.domain || ''}</span>
                    </div>
                    <ul class="article-list">
                        ${site.articles.map((art, i) => `
                            <li class="article-item ${i >= INITIAL_COUNT ? 'hidden extra-item' : ''}">
                                <span class="time-badge">${art.time || '1h'}</span>
                                <a href="${art.link}" class="article-link" target="_blank">${art.title}</a>
                            </li>
                        `).join('')}
                    </ul>
                    ${hasMore ? `
                        <div class="load-more-area">
                            <button class="load-more-btn" onclick="showMore(this)">Show More</button>
                        </div>
                    ` : ''}
                </div>
                `;
            }).join('');

            setupSearch();
        } catch (err) {
            grid.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding:50px;">数据加载失败</div>`;
        }
    }

    // 显示更多新闻的逻辑
    window.showMore = function(btn) {
        const column = btn.closest('.site-column');
        const extraItems = column.querySelectorAll('.extra-item');
        extraItems.forEach(item => item.classList.remove('hidden'));
        btn.parentElement.classList.add('hidden'); // 隐藏按钮区域
    };

    function setupSearch() {
        const input = document.getElementById('search-input');
        input.oninput = (e) => {
            const val = e.target.value.toLowerCase();
            document.querySelectorAll('.article-item').forEach(item => {
                const isMatch = item.innerText.toLowerCase().includes(val);
                item.classList.toggle('hidden', !isMatch);
            });
            // 搜索时自动隐藏“显示更多”区域，防止视觉干扰
            document.querySelectorAll('.load-more-area').forEach(area => {
                area.classList.toggle('hidden', val.length > 0);
            });
        };
    }

    init();
</script>
</body>
</html>
